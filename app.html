<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#ffffff">
    <title>Welcome to ECSD Kiosk Browser</title>
    <style>
        /* ... existing styles ... */
        .sign-out-button {
            position: absolute;
            top: 20px;
            right: 20px;
            cursor: pointer;
            font-size: 16px;
            background-color: #f44336;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <button class="back-button" onclick="goBack()">&#x2190;</button>
    <button class="sign-out-button" onclick="signOut()">Sign Out</button>

    <h1>Welcome to ECSD Kiosk Browser</h1>

    <img src="assets/icon.png" class="logo" alt="ECSD Logo">

    <marquee behavior="scroll" direction="left">
        This is managed by ECSD IT - Please ensure you log out when finished!
    </marquee>

    <div class="container">
        <!-- ... existing app icons ... -->
    </div>

    <script>
        // Check if the session is still valid
        chrome.storage.local.get(['sessionActive', 'sessionCounter'], (result) => {
            console.log('Session data:', result);
            if (!result.sessionActive || result.sessionCounter >= 50) {
                console.log('Session expired or invalid');
                alert('Session expired. Please log in again.');
                window.location.href = 'index.html';
            } else {
                console.log('Session is valid');
            }
        });

        const allowedDomains = [
            'mail.google.com',
            'www.commonapp.org',
            'www.yahoo.com',
            'www.collegeboard.org',
            'www.icloud.com'
        ];

        function goBack() {
            window.history.back();
        }

        function signOut() {
            chrome.runtime.sendMessage({action: "signOut"}, function(response) {
                if (response && response.success) {
                    window.location.href = 'index.html';
                }
            });
        }

        document.addEventListener('click', function (e) {
            const target = e.target.closest('a');
            if (target) {
                const domain = new URL(target.href).hostname;
                if (!allowedDomains.includes(domain)) {
                    e.preventDefault();
                    alert('Access to this domain is restricted.');
                }
            }
        });

        // Check for sign-out flag
        function checkSignOut() {
            if (localStorage.getItem('kioskSignedOut') === 'true') {
                localStorage.removeItem('kioskSignedOut');
                signOut();
            }
        }

        // Check for sign-out every 5 seconds
        setInterval(checkSignOut, 5000);

        // Also check on page load
        checkSignOut();
    </script>
</body>
</html>
