<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#ffffff">
    <title>ECSD Kiosk Browser</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: Arial, sans-serif;
        }
        #app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        #browser-tabs {
            display: flex;
            background-color: #f1f1f1;
            padding: 10px;
        }
        .tab {
            padding: 10px;
            margin-right: 5px;
            background-color: #ddd;
            cursor: pointer;
        }
        .tab.active {
            background-color: #fff;
        }
        #browser-content {
            flex-grow: 1;
            display: flex;
        }
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        #home-content {
            width: 100%;
            height: 100%;
            overflow: auto;
            padding: 20px;
            box-sizing: border-box;
        }
        .icon {
            width: 64px;
            margin: 10px;
            cursor: pointer;
        }
        #session-timer {
            position: fixed;
            top: 10px;
            right: 10px;
            background-color: #ff9800;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
        }
        #new-tab-button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="app-container">
        <div id="browser-tabs">
            <div class="tab active" data-tab="home">Home</div>
            <button id="new-tab-button">+</button>
        </div>
        <div id="browser-content">
            <div id="home-content">
                <h1>Welcome to ECSD Kiosk Browser</h1>
                <div id="app-icons">
                    <img src="assets/gmail.png" class="icon" alt="Gmail" onclick="openApp('https://mail.google.com/igu=1', 'Gmail')">
                    <img src="assets/commonapp.png" class="icon" alt="CommonApp" onclick="openApp('https://www.commonapp.org', 'CommonApp')">
                    <img src="assets/yahoo.png" class="icon" alt="Yahoo" onclick="openApp('https://www.yahoo.com', 'Yahoo')">
                    <img src="assets/collegeboard.png" class="icon" alt="CollegeBoard" onclick="openApp('https://www.collegeboard.org', 'CollegeBoard')">
                    <img src="assets/icloud.png" class="icon" alt="iCloud" onclick="openApp('https://www.icloud.com', 'iCloud')">
                </div>
            </div>
        </div>
    </div>
    <div id="session-timer">Session ends in: <span id="countdown">60</span>s</div>

    <script>
        const SESSION_TIMEOUT = 60000; // 1 minute in milliseconds
        let sessionTimer;
        let countdownInterval;
        let tabs = [{id: 'home', title: 'Home', url: ''}];
        let activeTabId = 'home';

        function startSessionTimer() {
            const startTime = Date.now();
            updateCountdown(SESSION_TIMEOUT);

            sessionTimer = setTimeout(() => {
                logout();
            }, SESSION_TIMEOUT);

            countdownInterval = setInterval(() => {
                const elapsed = Date.now() - startTime;
                const remaining = Math.max(0, SESSION_TIMEOUT - elapsed);
                updateCountdown(remaining);
            }, 1000);
        }

        function updateCountdown(remaining) {
            const seconds = Math.ceil(remaining / 1000);
            document.getElementById('countdown').textContent = seconds;
        }

        function openApp(url, name) {
            createNewTab(url, name);
            resetSessionTimer();
        }

        function createNewTab(url, name) {
            const tabId = 'tab-' + Date.now();
            tabs.push({id: tabId, title: name || 'New Tab', url: url});
            const tabElement = document.createElement('div');
            tabElement.className = 'tab';
            tabElement.textContent = name || 'New Tab';
            tabElement.dataset.tab = tabId;
            tabElement.onclick = () => activateTab(tabId);
            document.getElementById('browser-tabs').insertBefore(tabElement, document.getElementById('new-tab-button'));
            activateTab(tabId);
        }

        function activateTab(tabId) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector(`.tab[data-tab="${tabId}"]`).classList.add('active');
            const browserContent = document.getElementById('browser-content');
            browserContent.innerHTML = '';
            if (tabId === 'home') {
                browserContent.appendChild(document.getElementById('home-content'));
            } else {
                const iframe = document.createElement('iframe');
                iframe.src = tabs.find(tab => tab.id === tabId).url;
                browserContent.appendChild(iframe);
            }
            activeTabId = tabId;
        }

        function resetSessionTimer() {
            clearTimeout(sessionTimer);
            clearInterval(countdownInterval);
            startSessionTimer();
        }

        function logout() {
            alert('Session expired. Logging out...');
            window.location.href = 'logout.html';
        }

        document.getElementById('new-tab-button').onclick = () => createNewTab('about:blank');

        window.onload = function() {
            startSessionTimer();
        };
    </script>
</body>
</html>
